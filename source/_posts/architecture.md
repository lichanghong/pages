---
title: 架构设计
date: 2019-08-25 18:34:51
tags: "iOS架构"
categories: "iOS面试必看"
---



### 架构设计
1，接口设计（安全机制、接口数据、接口版本）
大部分App的接口都采用RESTful架构，RESTFul最重要的一个设计原则就是，
<!--more-->客户端与服务器的交互在请求之间是无状态的，也就是说，当涉及到用户状态时，每次请求都要带上身份验证信息。实现上，大部分都采用token的认证方式，一般流程是：
	1.	用户用密码登录成功后，服务器返回token给客户端；
	2.	客户端将token保存在本地，发起后续的相关请求时，将token发回给服务器；
	3.	服务器检查token的有效性，有效则返回数据，若无效，分两种情况：
	◦	token错误，这时需要用户重新登录，获取正确的token
	◦	token过期，这时客户端需要再发起一次认证请求，获取新的token
然而，此种验证方式存在一个安全性问题：当登录接口被劫持时，黑客就获取到了用户密码和token，后续则可以对该用户做任何事情了。用户只有修改密码才能夺回控制权。如何优化呢？第一种解决方案是采用HTTPS。HTTPS在HTTP的基础上添加了SSL安全协议，自动对数据进行了压缩加密，在一定程序可以防止监听、防止劫持、防止重发，安全性可以提高很多。不过，SSL也不是绝对安全的，也存在被劫持的可能。另外，服务器对HTTPS的配置相对有点复杂，还需要到CA申请证书，而且一般还是收费的。而且，HTTPS效率也比较低。一般，只有安全要求比较高的系统才会采用HTTPS，比如银行。而大部分对安全要求没那么高的App还是采用HTTP的方式。
接口数据使用（json/pb..）
接口升级加上版本号
2，技术选型
   * 原生与web  开发语言（oc、swift）   架构模式用MVC，还是MVP，或者MVVM
3，数据层设计
	一个App，从根本上来说，就是对数据的处理
	数据层，是三层架构中的最底层，负责数据的管理。它主要的任务就是：
	1.	调用网络API，获取数据；
	2.	将数据缓存到本地；
	3.	将数据交付给上一层。
根据这三个任务，数据层可以再拆分为三层：网络层、本地数据层、交付层。
    网络层主要就是对网络API的封装，网络状态觉得策略（4G、无网等）
    本地数据层主要就是做缓存处理，每份缓存数据都应该设置一个缓存的有效时间，有效期的起始时间以最后一次被调用的时间为准，当该数据长时间没有再被调用到时，就应该从缓存中清理掉
	 交付层是上层向数据层获取数据的入口。上层向数据层请求数据，它是不关心数据层的数据是从缓存获取还是从网络获取的。因此，交付层主要就是定义一堆开放的接口或协议,如果接口或协议非常多则按照模块划分
4，业务层设计
	业务层可以说是一个数据加工场，处理核心的业务逻辑
	业务层向下，与数据层交互；向上，与展示层交互。

```
第一个是新用户注册的例子。注册时，界面上一般都会要求用户输入手机号、验证码、密码和确认密码。但是，API接口一般只会有三个参数：手机号、验证码和密码，不会有确认密码。因此，调用接口之前，密码和确认密码的一致性检查是必须的。同时，也要检查这些数据是否为空、手机号是否符合规范、验证码是否有效、密码有没有包含了特殊字符等。正确姿势就是当所有检查都通过了之后，才调用API接口。最后，调用注册接口成功后，可能还要再调用一次登录接口，并可能将用户登录信息缓存起来，方便用户下次启动应用时自动登录。所有这些都属于业务逻辑处理，也就是业务层的工作。
第二个是涉及用户验证的例子。比如，在一个电商App，当用户浏览某个商品，点击购买时，App首先会判断用户是否已经登录，如未登录，则会跳转到登录页面让用户先登录。如果已经登录，但token已经过期，那需要先去获取新的token，之后才能进行下一步的购物操作。这些逻辑处理，也是业务层的工作。
因此，简单点说，业务层就是处理业务逻辑，包括数据的检查、业务分支的处理等。比如上面第二个例子，可能很多人就会将用户是否已经登录的判断直接在界面上做处理，当确认登录后，token也是有效的之后，才调用业务层做购买商品的操作，这就是导致业务层沦落为API的数据中转站的直接表现。
引用：http://keeganlee.me/post/architecture/20160214
```

